import time
from locust import HttpUser, TaskSet, task, between, events
import sys, os, json, requests, hashlib, re

import pdb
import random

# host=http://18.203.115.216:5007

rerank_data = [
    {'query': 'do i need to pay for the hepatitis b vaccine ', 'texts': [['1191', "Is it possible to get the third Hep B vaccine earlier than 6 months? I need it for a school program due August 2019. My first Heb B shot was on April 7th. When's the earliest I could finish the Heb B series?"], ['619', 'I had the Hep B vaccine back in elementary school, but want to get a titer test to check my antibody levels. Where can I get tested, and who can I speak to set that up?\n'], ['1082', "I have my child health passport. In the basic schedule and record of immunization, Hep B is listed but not Hep A. Does that mean that my child didn't get the Hep A vaccine?\n"], ['1051', 'I have been diagnosed with Fatty Liver disease and my GP has had me tested and I do NOT have immunity to Hep B. She suggested I may be eligible for the free vaccination.\n'], ['457', 'Do I need to pay for the hepatitis B vaccine?\n'], ['165', 'My first two Hep B shots were on schedule, but my third was many years later. Should I get a blood test to check for immunity, or is a long break between the second and third ok?\n'], ['994', 'Hi, I work as a temp at a medical office and do not have my Hep B shots. I was not vaccinated as a child, and am born before 1980. Where would I go to get them free of cost?'], ['257', 'Once I have the Hepatitis b vaccine injections would I be free from getting Hepatitis b from my girlfriend who is a carrier of Hepatitis b when we have intercourse or kiss?\n'], ['197', 'how often should you get hepatitis b vaccine?\n'], ['535', 'Can you drink alcohol the day of getting the hepatitis b vaccine?\n'], ['724', 'Is the Hepatitis B vaccine only given to infants at high risk of contracting the disease?\n'], ['1003', "I received the Hepatitis B vaccine series in 1985 but don't have a record of it. My work requires me to get the Hepatitis B series. Is it safe to get it again?"], ['968', "My girlfriend/wife to be is 44 yrs old and is a carrier of Hepatitis b, I'm 49 yrs old and have type 2 diabetes pills only after I get the vaccine can we have intercourse ?"], ['901', 'who invented hepatitis b immune globulin\n'], ['319', 'Work Safe BC has recommended that all employees in our workplace should get a Hepatitis B Vaccine. Is there a program available to have someone come to our workplace to immunize?\n'], ['181', "I'd like to kindly ask for information regarding being administered the Hep B Vaccine. I am a student (health care profession). Been waiting for about 4 months now. Thank you."], ['615', "I'm 22 and I received all the usual vaccinations that you get in school so do I need a booster shot of the hepatitis or tetanus vaccine before I go to a Mexican resort?"], ['65', 'Hepatitis B - 3 X Post-vaccine still NOT Immune ? In the last 20 years I have been vaccinated for Hepatitis B 3 times. The 3rd time I was vaccinated with Energix B on Aug 28 and Sep 25 2014, and on Apr 02, 2015. On 25 Jan 18 my Hep B Surface antibody (HBsAb) is'], ['827', 'When did BC start routine Hep B immunization in children?\n'], ['849', "I had Hepatitis B vaccine injection in South Korea (June&August,2018). So I was wondering where can I get my third injection in Vancouver. I don't have neither PR Card/citizenship."], ['256', 'Can I get hepatitis B vaccine ,MMR and Diptheria vaccines for free? I am a nursing student and we need it for clinical practice. Thanks\n'], ['1432', 'Does my employer have to provide Hepatitis A or Hepatitis B shots if the job includes handling raw sewage?\n'], ['807', 'I am a first aid attendant at my job, do I qualify for a free Hep B immunization? If so, are there forms I need to get it free?\n'], ['988', 'Hello, please confirm that my daughter has received the Hep B vaccination in Grade 6. Thank you.'], ['282', 'I am a new commer who has immigrated to B.C .I am a kidney transplant patient .I need to get a hepatitis vaccine.how can I do it?\n'], ['84', "I'm over seas and my 23 month old is over due for her 3rd Hep B immunization dose (BC had to catch her up with their schedules since we moved from Alberta so she took 2 doses within 4 months) how long can we postpone it? Is it urgent for her to take the 3rd dose?"], ['796', "I got vaccinations in school as a child (born 1986) but don't know what they were for. What vaccines were offered through public schools while I attended school? What boosters do I need as an adult today? Am I immunized currently as an adult for tetanus and Hep B?"], ['565', 'Hello, I am travelling this winter and trying to find a Hep B booster. Do you have any in stock right now? Thank you\xa0\n'], ['811', 'What are the difference between a HBIG vaccine and a Hepatitis B vaccine?\n'], ['79', 'I am an acupuncturist and my registration body suggests to immunized Hep B. Is Heptitis B vaccination covered for health care provider in BC/\n'], ['1415', "My husband and I are permanent residents in BC. My daughter (9m old) was born in Denmark and not a Canadian citizen. We are living in BC. My daughter's PR application is in process and I believe she will get it early 2020. Can she get free vaccination now? She didn't have Hepatitis B vaccination."], ['175', 'Why is Hepatitis B vaccine given to infants now instead of in grade 6'], ['266', 'My 18 month old accidentally got a fourth dose of Hep B will he be okay?'], ['688', 'Would hotel housekeepers be considered High Risk for Hepatitis B?\n'], ['774', 'I need a booster of Hep B (have had two at work previously). I need the series of Hep A. Are these free? My Family Doctor says there is a fee and cost for both shots.\n'], ['902', 'Hi, I need a Hepatitis-B Vaccine. But all the health report is in Chinese. Should I translate it before I see a doctor? Where can I find a professional translator?\n'], ['1166', 'son brought Hepatitis B vaccine letter home from school. We are from the UK and he had Hib Catch up when he was 4, does he still need this vaccine now he is in grade 6 in Canada?'], ['1060', 'Hi I am 31 yo. I work as a Care aide at a seniors facility and I am also in nursing school. I need Hep B and Varicella vaccines. I can get those for free right? Thanks'], ['1427', "I don't have my son's updated or correct record of immunization from India, should I get him vaccinated for Hep B again? It is likely that he had Hep B vaccination done but as we changed the family doctor, they never transferred details. He is in Vancouver and Gr.6. since May 2015."], ['910', 'Hi I was just wanting to know when BC started doing hep B shots? I am asking because I am 31 now and traveling to Thailand and need to get that shot. I attended public school.'], ['316', 'Hi I am wondering where the records of school based immunizations are found Also The hep b vaccine was universally given to newborns in what year?\n'], ['377', 'How do I go about getting a Hep A/B vaccine?\n'], ['1457', 'Hepatitis A junior vaccine can be given to child at public health unit? These vaccinations are back order everywhere so can I get it done at public health unit.do I have to pay or not?\n'], ['112', 'hi i would like to ask about for immunization hepatitis A for my mom, cause her family doctor tell her get the immunization, but i dont know where my mom should go for, thanks.\n'], ['143', 'my 11 year old daughter received immunizations forms for grade 6, she was vaccinated for hep b nov 3 2003, jan 19 2004, and nov 23 2004. does she need a booster shot for grade 6?'], ['1004', "Why is there no comments about getting tested after having the Vaccine for Hepatitis A & B to find out if it took? My wife and I had to be re-vaccinated, the first vaccine didn't take?\n"], ['418', "Hi- I don't remember if I was vaccinated for hep a and b? Is it safe just to get them if there is a possibility I might been vaccinated 10 years+ ago?"], ['355', "Hi there. I'd like to find out when I was last vaccinated for Hepatitis A. Actually, I would like to see my vaccination records.\n"], ['1106', 'I believe i had my Hep B shots in 2008 but my GP does not have a record. They suggested I contact you as you track immunizations. Can you assist?'], ['1445', 'I paid for some vaccines that I thought would be covered because of my indigenous status. I paid for Hepatitis A and Typhoid, as well as the appointment fee, but had other friends that did not have to pay. The vaccines were not available on Haida Gwaii so I had to travel to Vancouver to receive.\n']]},
    {'query': 'can my daughter get immunised if she has a cold  ', 'texts': [['143', 'my 11 year old daughter received immunizations forms for grade 6, she was vaccinated for hep b nov 3 2003, jan 19 2004, and nov 23 2004. does she need a booster shot for grade 6?'], ['361', 'Can a child get immunized if they have a cold?\xa0.'], ['471', 'Does my mother, who is over 65 and immunization history unknown, qualify for a free pertussis vaccine? Our local health unit in BC said no but according to your website she should.'], ['1132', "i'm just wondering my daughter she didn't get a vaccine at 18 months now she's 22 months, still she can get it?"], ['895', 'Should I bring my 7mth old to get her flu vaccine booster if she has had a bad cold for the last week? Or should I wait until she is healthy again?'], ['275', "Dear nurses, My daughter,14 years old, has just came here from China for studying at a High school. I'm wondering if she can take HPV for free. When and where could she take the vaccine ?"], ['295', "Hello my daughter has a 18 month immunization tomorrow she taking antibiotics it's ok to do the vaccine"], ['1183', 'Chicken pox vaccine says not to get pregnant for 30 days after vaccine, is this 30 days after first vaccine or 30 days after booster 4 weeks later?'], ['938', 'My daughter got her first vaccination for HPV 2yrs ago, has not received the second dose. it has been 2 years, does she need to repeat the first or can she just receive the 2nd'], ['750', "My child in grade nine was away from school today and has not gotten his shots, what do I do? I just found out that my daughter didn't get hers either she is in grade 11 now can she still get hers too?"], ['752', 'My daughter has a bright red spot where she received one of her 12 month immunizations and it has persisted for 2 weeks now. Is this something to be concerned about?'], ['739', 'my daughter has the vaccine for meningite C and pneumococcal conjugate. Should she take the meningococcal quadrivalent Conjugate\n'], ['821', 'My daughter was born in another country and became a resident of Canada. but msp is waiting period. She is two months. Can she get her first vaccination for free?\n'], ['486', 'Can you catch chickenpox from someone suffering from shingles? My daughter had only 1 of the 2 vaccinations for chicken pox previously and is scared. Should she avoid the person who has shingles?'], ['1230', 'My daughter requires the following immunizations for school: tetanus, bovine tuberculosis, rabies, meningitis C, mumps. Can she get these at the public health unit?\n'], ['1425', 'My daughter has had one vacination for mesles - perhaps 2 but she is not sure. To be safe, can she safely get another measles shot before she travels? She is 26. Thank you'], ['837', 'My 10 years old daughter has suffered from Kawasaki disease(when she is 7 months old ) which influences her immune system .To be safe , should she have a kind of test before getting new vaccines ?'], ['334', 'I lost my immunization card for my daughter can I get a new one?\n'], ['388', 'My daughter received her varicella vaccine at 18 months. Her immunization records show she never received a second vaccination. She is now 18 years old. Should she get one now?'], ['49', "My daughter got 2 shot of HPV in 2014 when she was in grade 6. She didn't get the third shot from the school nurse last year. Where can she get the third shot to finish the whole series?"], ['298', 'My child was fully immunised overseas and has not had INFANRIX HEXA at 18mths (not offered), my child is now 2. Do we need it or should we wait till 4ys old?'], ['480', 'My daughter just received the HPV vaccine at school (grade 6). Can she also get the flu vaccine this year? How long should she wait before getting the flu vaccine?'], ['1300', 'unimmunized children in contact with 4 month old immunized infant is it safe'], ['927', 'My daughter had her initial vaccinations in 2002 when she was two months old but has received only her Tetanus since then. What is the best schedule for her to "catch up"?'], ['961', "I had a head cold a couple of weeks ago that has left me with a cough that won't go away. Can I still get the flu shot?\n"], ['1266', 'My child has the flu and is scheduled for her grade 9 vaccines, can she still take them?'], ['703', 'which dtap vaccine do you use for 2 year olds. My daughter needs the dtap plus polio. She has had the HIB vaccine and does not need the hep B at this time. thx'], ['67', 'My daughter was vaccinated at school last year.... grade 6 I just want to confirm which shots she received. She received 2 shots.'], ['783', 'Hi, My daughter is 11. She got all the prior to 11 vaccines. However, she got only one for HPV at school recently while the vaccine booklet says 3. Should she get the other two?'], ['449', 'Hello !my daughter will be 1year old on this November but she is going outside to Canada and will come back in march .so is it ok if she take ist years vaccines in march ?'], ['1442', "My daughter who is in Gr 6 has just moved to Canada in July and doesn't have the personal health number now. Is she eligible to have the immunization in the school based program?"], ['729', 'My daughter had her first set of gr. 6 vaccines last week. She spent the next day achy and vomiting. Is this a normal reaction?'], ['1147', 'Can I immunize my baby (for her 1-year shots) if she has had a fever in the last 24 hours? Her appt for the immunization is today.'], ['1286', 'My daughter was born in 1991 and received the mmr plus the booster as a baby. Does she need another booster in light of the recent measles outbreak?'], ['305', 'My daughter was born in 1997. Would she have been given both doses on the measles vaccine?'], ['998', 'Our daughter will be visiting with a baby who has not had her Pertussis Immunization. She wants us to have the immunization before she arrives.\n'], ['670', 'My child has anxiety. Where can they get their vaccines outside of school?\n'], ['897', 'I live in coquitlam,where can I get immunization for my grand daughter ?she is 4 monthes now!'], ['1204', 'My daughter never got her grade 9 shots where can we get them done now'], ['248', "Where can I get a copy of the immunizations my child has received, as I don't have all of them documented in her book?\n"], ['497', 'Hi, I have 4 year old grandchild from Saskatoon in visit here. Where I could take him to receive flu shoot as out of province child? What I need to bring? I have picture of his Saskatchewan Health Card on my IPhone.'], ['1372', "Hi, My daughter (grade 9ï¼‰has had 4 combined vaccines of Diphtheria, pertussisand Tetanus .The last shot was in her 7 years old.(before coming to Canadaï¼‰.Does she need get further vaccine of Diphtheria, pertussisand Tetanu? She got a form of 'consent for Grade 9 immunization' from school."], ['62', 'I did not immunize my child as an infant. She is now six and I have changed my stance. Can she be immunized now?\n'], ['81', 'my daughter needs her grade 6 shots (age 12) is the hpv9 replacing hpv4? Has meningococcal c changed to a 4 strain vaccine given in grade 9 and nothing in gr 6?'], ['1220', "I recently decided to get my 10 month old daughter vaccinated. She's had no shots yet. What happens now? Does she get all the shots she missed at once?"], ['621', 'How come Switzerland has a vaccine for ticks. Our daughter and her children will be vaccinated on Wednesday. Why is there nothing here in Canada?\n'], ['1187', 'My child is 10,5 years old and I would like to know if she is due for immunization. Where can I find this information and how can I obtain her immunization schedule.'], ['1335', 'My three year old just received the flu vaccine. It was mentioned that she should get a booster dose. Does she need to get that this year? Or next year is fine?\n'], ['369', 'My daughter born June 2009 received PCV 7 in her first year. June 2010, it was replaced with PCV13. Should she receive a booster with PCV13 for protection against other 6 strains?'], ['1415', "My husband and I are permanent residents in BC. My daughter (9m old) was born in Denmark and not a Canadian citizen. We are living in BC. My daughter's PR application is in process and I believe she will get it early 2020. Can she get free vaccination now? She didn't have Hepatitis B vaccination."]]},
    {'query': 'can my daughter get immunised if she has a cold  booster rubella she is 6 years old ', 'texts': [['143', 'my 11 year old daughter received immunizations forms for grade 6, she was vaccinated for hep b nov 3 2003, jan 19 2004, and nov 23 2004. does she need a booster shot for grade 6?'], ['264', "I was separately vaccinated for Measles, Mumps and Rubella in 1973/74. I also have BC immunization records for Mumps and Rubella boosters in '81 and '83 respectively. Would either of these boosters have contained the Measles booster?"], ['895', 'Should I bring my 7mth old to get her flu vaccine booster if she has had a bad cold for the last week? Or should I wait until she is healthy again?'], ['484', 'I received a booster for Rubella at the pop-up immunization clinic at UBC during the Rubella outbreak of 1997. Would that have been Rubella only, or the full MMR?'], ['451', "I have immunization records showing in 1997 I had a Measles/Rubella vaccine. Is this the same as the MMR? I had the MMR in 1975. can I assume I'm fully immunized for measles then?"], ['795', 'I was born in 1955. I had measles once and mumps. I never had rubella (German measles). Am I immune to rubella?'], ['1180', 'My blood test shows immunity to measles and mumps only do I need rubella shot?\n'], ['925', "I have 2 documented doses of MMR. However, a recent lab test shows that I have no immunity to rubella. I'm a health care worker of child bearing age. Am I eligible for a 3rd dose?"], ['128', "I was born in BC in 1970 and I have my immunization records but I don't understand if I have had a booster for measles. Can you help confirm the information on my card? MMR(86)\xa0 Measles(72)\xa0 Rubella (72) Does this mean I have had my measles shot in 1972 and booster in 1986?"], ['938', 'My daughter got her first vaccination for HPV 2yrs ago, has not received the second dose. it has been 2 years, does she need to repeat the first or can she just receive the 2nd'], ['1286', 'My daughter was born in 1991 and received the mmr plus the booster as a baby. Does she need another booster in light of the recent measles outbreak?'], ['1335', 'My three year old just received the flu vaccine. It was mentioned that she should get a booster dose. Does she need to get that this year? Or next year is fine?\n'], ['369', 'My daughter born June 2009 received PCV 7 in her first year. June 2010, it was replaced with PCV13. Should she receive a booster with PCV13 for protection against other 6 strains?'], ['783', 'Hi, My daughter is 11. She got all the prior to 11 vaccines. However, she got only one for HPV at school recently while the vaccine booklet says 3. Should she get the other two?'], ['275', "Dear nurses, My daughter,14 years old, has just came here from China for studying at a High school. I'm wondering if she can take HPV for free. When and where could she take the vaccine ?"], ['1089', "Hello, my child received the measles vaccination at ten months. She is now 2 years and 1 month. Do you think it's too early to give her a booster?"], ['388', 'My daughter received her varicella vaccine at 18 months. Her immunization records show she never received a second vaccination. She is now 18 years old. Should she get one now?'], ['837', 'My 10 years old daughter has suffered from Kawasaki disease(when she is 7 months old ) which influences her immune system .To be safe , should she have a kind of test before getting new vaccines ?'], ['757', "Hi How can I get a record of my child's immunizations that they received through the public school system. After high school , when and what do they need booster vaccinations of?\n"], ['893', 'Where and how can I get a booster for the Tetanus, Diphtheria vaccine? It has been 10 years since my last booster.'], ['34', 'Is it possible to only get the measles vaccine without the mumps, rubella and varicella portion for a 6 year old? He has had very bad reactions to other vaccines.'], ['563', 'I have a 13 month old who had his 12 month vaccinations last month. Given the recent measles cases, are you recommending bumping up the 2nd MMR vaccine ? I have read that a second dose can be given if more than 28 days has past between vaccinations.'], ['1132', "i'm just wondering my daughter she didn't get a vaccine at 18 months now she's 22 months, still she can get it?"], ['471', 'Does my mother, who is over 65 and immunization history unknown, qualify for a free pertussis vaccine? Our local health unit in BC said no but according to your website she should.'], ['305', 'My daughter was born in 1997. Would she have been given both doses on the measles vaccine?'], ['449', 'Hello !my daughter will be 1year old on this November but she is going outside to Canada and will come back in march .so is it ok if she take ist years vaccines in march ?'], ['492', 'My child is turning 4 on April 15. She is not going to any preschool just at home. Where and how do I know if she needs immunization boosters already? Where to have it done?'], ['404', 'Can my son get his MMRV shot sooner than 4 years old? Like ASAP?'], ['957', 'I am 25 yrs old. My doctor advised me to get Rubella Vaccine before I plan to get pregnant. Where can I go to get Rubella Vaccine for free of cost in Surrey BC.'], ['67', 'My daughter was vaccinated at school last year.... grade 6 I just want to confirm which shots she received. She received 2 shots.'], ['428', 'Would it hurt to get a booster vaccine of twinrix after 13 years? My wife has just received a booster after having had the series of three shots 13 years ago.'], ['480', 'My daughter just received the HPV vaccine at school (grade 6). Can she also get the flu vaccine this year? How long should she wait before getting the flu vaccine?'], ['49', "My daughter got 2 shot of HPV in 2014 when she was in grade 6. She didn't get the third shot from the school nurse last year. Where can she get the third shot to finish the whole series?"], ['548', "I'm wondering if I need a measles shot. My mom's records show I had a 'red and German' measles shot at age 2, and mumps at age 10 (as well as other shots). Is that sufficient?"], ['1206', 'According to my records, I was vaccinated with the measles/rubella vaccine in elementary school in 1996. Does this include the second shot and am I protected from the recent measles outbreak?'], ['1425', 'My daughter has had one vacination for mesles - perhaps 2 but she is not sure. To be safe, can she safely get another measles shot before she travels? She is 26. Thank you'], ['295', "Hello my daughter has a 18 month immunization tomorrow she taking antibiotics it's ok to do the vaccine"], ['967', "I got the single-dose MMR as a child. My doctor won't do a blood test to see if I have full immunity. I was born in 1968 but did NOT have measles as a child. I want an MMR booster but no clinic or pharmacy will do one due to my age. How do I get the MMR booster?"], ['870', 'What to do if the second booster of Hepatitis a booster is missed for a child?\n'], ['729', 'My daughter had her first set of gr. 6 vaccines last week. She spent the next day achy and vomiting. Is this a normal reaction?'], ['204', "HELLO. HOW DO I KNOW WHETHER MY KID'S IMMUNIZATION IS EFFECTIVE OR NOT? SHE IS 10 YEARS OLD. SHE WAS VACCINATED IN CHINA. I AM WORRIED ABOUT THAT."], ['1183', 'Chicken pox vaccine says not to get pregnant for 30 days after vaccine, is this 30 days after first vaccine or 30 days after booster 4 weeks later?'], ['821', 'My daughter was born in another country and became a resident of Canada. but msp is waiting period. She is two months. Can she get her first vaccination for free?\n'], ['1274', 'my 11year received one immunization for chicken pox (varicella) aug 8/08, they are asking her for two doses for her grade 6 boosters, does she need both or one'], ['192', 'Can my child get the MMR or MMRV booster before they enter kindergarten? They are now 22 months old, and had the initial MMR vaccine on time.'], ['750', "My child in grade nine was away from school today and has not gotten his shots, what do I do? I just found out that my daughter didn't get hers either she is in grade 11 now can she still get hers too?"], ['1187', 'My child is 10,5 years old and I would like to know if she is due for immunization. Where can I find this information and how can I obtain her immunization schedule.'], ['1442', "My daughter who is in Gr 6 has just moved to Canada in July and doesn't have the personal health number now. Is she eligible to have the immunization in the school based program?"], ['927', 'My daughter had her initial vaccinations in 2002 when she was two months old but has received only her Tetanus since then. What is the best schedule for her to "catch up"?'], ['1320', 'can a 34 married female who had a 10-year-old boy get injected with HPV9 vaccine? she was infected by hpv(high in hpv16 18 52)two years ago, and she is fine after the surgery.']]}
]

class SearchEngineUser(HttpUser):
    wait_time = between(1, 2)

    @task
    def index(self):
        
        x = random.choice(rerank_data)
        response = self.client.get("/api/v1/reranking-cache", json=json.dumps(x))
        if response.status_code == 210 or response.status_code == 429:
            response.success()
            # check in actual
            response1 = self.client.get("/api/v1/reranking", json=json.dumps(x))
            if response1.status_code == 429:
                response1.success()
            else:
                scoreDocs = response.json()['scoreDocs']
        else:
            scoreDocs = response.json()['scoreDocs']